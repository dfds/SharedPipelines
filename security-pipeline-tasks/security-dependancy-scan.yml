parameters:
- name: sourceDirectory
  type: string
  default: '$(Build.SourcesDirectory)'
- name: failOnCVSS
  type: number
  default: 0
- name: warnOnCVSSViolation
  type: boolean
  default: false

steps:
- task: dependency-check.dependencycheck.dependency-check-build-task.dependency-check-build-task@6
  displayName: 'Dependency Check'
  inputs:
    projectName: adsasd
    scanPath: "${{ parameters.sourceDirectory }}"
    reportsDirectory: "$(Agent.TempDirectory)/dependency-scan-results"
    reportFilename: dependency-scan-results
    warnOnCVSSViolation: "${{ parameters.warnOnCVSSViolation }}"
	  failOnCVSS: ${{ parameters.failOnCVSS }}
	  format: ALL

- task: CopyFiles@2
  inputs:
    SourceFolder: '$(Agent.TempDirectory)/dependency-scan-results'
    contents: "*.sarif" 
    targetFolder: $(Agent.TempDirectory)/sast-results/dependency-scan-results/
  

- task: DeleteFiles@1
  displayName: 'Remove unneeded files'
  inputs:
    SourceFolder: '$(Agent.TempDirectory)'
    contents: "$(Agent.TempDirectory)/*.sarif" 